
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>Styleguide &#8212; Django Status Page 0.1.0 documentation</title>
    <link rel="stylesheet" type="text/css" href="_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="_static/alabaster.css" />
    <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/doctools.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="How-To" href="howto.html" />
    <link rel="prev" title="Status Page API" href="api.html" />
   
  <link rel="stylesheet" href="_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <section id="styleguide">
<h1><a class="toc-backref" href="#table-of-contents">Styleguide</a><a class="headerlink" href="#styleguide" title="Permalink to this headline">¶</a></h1>
<div class="contents topic" id="table-of-contents">
<p class="topic-title">Table of contents</p>
<ul class="simple">
<li><p><a class="reference internal" href="#styleguide" id="id1">Styleguide</a></p>
<ul>
<li><p><a class="reference internal" href="#practices" id="id2">Practices</a></p>
<ul>
<li><p><a class="reference internal" href="#initialize-local-development-environment" id="id3">Initialize Local Development Environment</a></p></li>
<li><p><a class="reference internal" href="#tokens-and-secrets-in-environment-variables" id="id4">Tokens and Secrets in Environment Variables</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#testing" id="id5">Testing</a></p>
<ul>
<li><p><a class="reference internal" href="#group-test-cases-by-target" id="id6">Group test cases by target</a></p></li>
<li><p><a class="reference internal" href="#define-test-type-for-each-test-case" id="id7">Define test type for each test case</a></p></li>
<li><p><a class="reference internal" href="#test-coverage" id="id8">Test Coverage</a></p></li>
<li><p><a class="reference internal" href="#git-push-quality-gates" id="id9">Git push quality gates</a></p></li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
<section id="practices">
<h2><a class="toc-backref" href="#table-of-contents">Practices</a><a class="headerlink" href="#practices" title="Permalink to this headline">¶</a></h2>
<section id="initialize-local-development-environment">
<h3><a class="toc-backref" href="#table-of-contents">Initialize Local Development Environment</a><a class="headerlink" href="#initialize-local-development-environment" title="Permalink to this headline">¶</a></h3>
<p>You can create a directory named <code class="docutils literal notranslate"><span class="pre">.dev</span></code> in your local repository copy and use it
for environment intialization purposes or store some resources that you need during
development. The <code class="docutils literal notranslate"><span class="pre">.dev</span></code> directory is already added to <code class="docutils literal notranslate"><span class="pre">.gitignore</span></code>.</p>
<p>Inisde the <code class="docutils literal notranslate"><span class="pre">.dev</span></code> directory create a <code class="docutils literal notranslate"><span class="pre">set_env</span></code> script to initialize environment variables
for the applciation.</p>
<p>Here is an example of Bash <code class="docutils literal notranslate"><span class="pre">set_env.sh</span></code> script:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="ch">#!/bin/sh</span>

<span class="nb">export</span> <span class="nv">DJANGO_SECRET_KEY</span><span class="o">=</span><span class="s2">&quot;Very, Very Secret Key. Do not tell anybody!&quot;</span>
</pre></div>
</div>
<p>And also an example of Windows commdnd file <code class="docutils literal notranslate"><span class="pre">set_env.cmd</span></code>:</p>
<div class="highlight-bat notranslate"><div class="highlight"><pre><span></span><span class="p">@</span><span class="k">ECHO</span> OFF

<span class="p">@</span><span class="k">SET</span> <span class="s2">&quot;DJANGO_SECRET_KEY=django-insecure-9312345....9876&quot;</span>
</pre></div>
</div>
</section>
<section id="tokens-and-secrets-in-environment-variables">
<h3><a class="toc-backref" href="#table-of-contents">Tokens and Secrets in Environment Variables</a><a class="headerlink" href="#tokens-and-secrets-in-environment-variables" title="Permalink to this headline">¶</a></h3>
<p>Security tokens and secrets should be stored in environment variables.
Hardcoded secrets are not allowed.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">os</span>

<span class="n">SECRET_KEY</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s1">&#39;DJANGO_SECRET_KEY&#39;</span><span class="p">]</span>
</pre></div>
</div>
<p>Do not use default value when reading the environment variable to enforce target
environment to define the variable and avoid security issues. For local development,
add the initializaition of the variables to your <code class="docutils literal notranslate"><span class="pre">.dev/set_env</span></code> script:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">export</span> <span class="nv">DJANGO_SECRET_KEY</span><span class="o">=</span><span class="s2">&quot;Very, Very Secret Key. Do not tell anybody!&quot;</span>
</pre></div>
</div>
</section>
</section>
<section id="testing">
<h2><a class="toc-backref" href="#table-of-contents">Testing</a><a class="headerlink" href="#testing" title="Permalink to this headline">¶</a></h2>
<section id="group-test-cases-by-target">
<h3><a class="toc-backref" href="#table-of-contents">Group test cases by target</a><a class="headerlink" href="#group-test-cases-by-target" title="Permalink to this headline">¶</a></h3>
<p>Group related test cases into a test class. For example, to test the <code class="docutils literal notranslate"><span class="pre">camel_case_split</span></code> function:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">TestCamelCaseSplit</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;Test cases for camel_case_split function&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">test_called_with</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">shortcuts</span><span class="o">.</span><span class="n">camel_case_split</span><span class="p">(</span><span class="s1">&#39;PascalCase&#39;</span><span class="p">)</span>
        <span class="k">assert</span> <span class="n">result</span> <span class="o">==</span> <span class="p">[</span><span class="s1">&#39;Pascal&#39;</span><span class="p">,</span> <span class="s1">&#39;Case&#39;</span><span class="p">]</span>
</pre></div>
</div>
</section>
<section id="define-test-type-for-each-test-case">
<h3><a class="toc-backref" href="#table-of-contents">Define test type for each test case</a><a class="headerlink" href="#define-test-type-for-each-test-case" title="Permalink to this headline">¶</a></h3>
<p>Test cases are grouped by test type (unit, system, etc.). To group tests <cite>pytest marks</cite> are used.
Each test case can be marked with zero, one or more marks.</p>
<p>Following marks are registered in <code class="docutils literal notranslate"><span class="pre">pytest.ini</span></code>:</p>
<blockquote>
<div><ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">unit</span></code> - Unit test</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">system</span></code> - System test</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">integration</span></code> - Integration test</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">compat</span></code> - Compatibility test</p></li>
</ul>
</div></blockquote>
<p>To mark individual test cases, use the <code class="docutils literal notranslate"><span class="pre">&#64;pytest.mark</span></code> decorator:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pytest</span>

<span class="nd">@pytest</span><span class="o">.</span><span class="n">mark</span><span class="o">.</span><span class="n">unit</span>    <span class="c1"># Mark following test case as unit test case</span>
<span class="k">def</span> <span class="nf">test_addition</span><span class="p">():</span>
    <span class="k">assert</span> <span class="mi">2</span><span class="o">+</span><span class="mi">3</span> <span class="o">==</span> <span class="mi">5</span>
</pre></div>
</div>
<p>If <code class="docutils literal notranslate"><span class="pre">&#64;pytest.mark</span></code> decorator is applied to a class, all the test cases from the class are marked with the
mark.</p>
<p>To mark all tests in a module define pytestmark module variable and assign to a mark or
a list of marks:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">pytestmark</span> <span class="o">=</span> <span class="n">pytest</span><span class="o">.</span><span class="n">mark</span><span class="o">.</span><span class="n">unit</span>    <span class="c1"># All test cases in the module</span>
                                 <span class="c1"># are marked as unit test cases</span>

<span class="n">pytestmark</span> <span class="o">=</span> <span class="p">[</span><span class="n">pytest</span><span class="o">.</span><span class="n">mark</span><span class="o">.</span><span class="n">unit</span><span class="p">,</span> <span class="n">pytest</span><span class="o">.</span><span class="n">mark</span><span class="o">.</span><span class="n">compat</span><span class="p">]</span>  <span class="c1"># All test cases in the module</span>
                                                     <span class="c1"># are marked as unit and compat test cases</span>
</pre></div>
</div>
<p>By default <code class="docutils literal notranslate"><span class="pre">pytest</span></code> runs only unit tests as specified in <code class="docutils literal notranslate"><span class="pre">pytest.ini</span></code>.</p>
<p>To execute specific type of tests, e.g. <code class="docutils literal notranslate"><span class="pre">system</span></code>, pass the type as argument to the <code class="docutils literal notranslate"><span class="pre">-m</span></code> option:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>pytest -m <span class="s2">&quot;system&quot;</span>
</pre></div>
</div>
<p>To execute all tests pass empty argument to the <code class="docutils literal notranslate"><span class="pre">-m</span></code> option:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>pytest -m <span class="s2">&quot;&quot;</span>
</pre></div>
</div>
<p>More examples:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span><span class="c1"># Execute all test cases, but unit tests</span>
<span class="gp">$ </span>pytest -m <span class="s2">&quot;not unit&quot;</span>
<span class="gp">$</span>
<span class="gp">$ </span><span class="c1"># Execute only system and integration tests</span>
<span class="gp">$ </span>pytest -m <span class="s2">&quot;system or integration&quot;</span>
<span class="gp">$</span>
<span class="gp">$ </span><span class="c1"># Execute only test cases which are system and integration at the same time</span>
<span class="gp">$ </span>pytest -m <span class="s2">&quot;system and integration&quot;</span>
</pre></div>
</div>
<p>To learn more about <code class="docutils literal notranslate"><span class="pre">pytest</span></code>’s custom marks:</p>
<ul class="simple">
<li><p><a class="reference external" href="https://docs.pytest.org/en/6.2.x/mark.html">Marking test functions with attributes</a></p></li>
<li><p><a class="reference external" href="https://docs.pytest.org/en/6.2.x/example/markers.html">Working with custom markers</a></p></li>
</ul>
</section>
<section id="test-coverage">
<h3><a class="toc-backref" href="#table-of-contents">Test Coverage</a><a class="headerlink" href="#test-coverage" title="Permalink to this headline">¶</a></h3>
<p>Measure the test coverage on each test execution. Add corresponding options to <code class="docutils literal notranslate"><span class="pre">pytest.ini</span></code>:</p>
<div class="highlight-ini notranslate"><div class="highlight"><pre><span></span><span class="c1"># pytest.ini</span>
<span class="k">[pytest]</span>
<span class="na">addopts</span> <span class="o">=</span>
    <span class="na">-m &quot;unit&quot;</span>
    <span class="na">--cov djangostatuspage</span>
    <span class="na">--cov-report term</span>
    <span class="na">--cov-report html</span>
</pre></div>
</div>
</section>
<section id="git-push-quality-gates">
<h3><a class="toc-backref" href="#table-of-contents">Git push quality gates</a><a class="headerlink" href="#git-push-quality-gates" title="Permalink to this headline">¶</a></h3>
<p>Before pushing code to the remote repository make sure that all quality requirements are met:</p>
<ul class="simple">
<li><p>All unit tests pass</p></li>
<li><p>Minimal unit test coverage is 80%</p></li>
</ul>
<p>To automate these checks, modify the Git pre-push hook in the <code class="docutils literal notranslate"><span class="pre">.git/hooks/pre-push</span></code> script:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="ch">#!/bin/sh</span>

<span class="nb">source</span> .venv310/Scripts/activate
./.dev/set_env.sh
pytest --rootdir<span class="o">=</span>src/djangostatuspage/tests <span class="o">||</span> <span class="nb">exit</span> <span class="m">1</span>
coverage report --fail-under<span class="o">=</span><span class="m">80</span> <span class="o">||</span> <span class="nb">exit</span> <span class="m">1</span>
<span class="nb">exit</span> <span class="m">0</span>
</pre></div>
</div>
</section>
</section>
</section>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="index.html">Django Status Page</a></h1>








<h3>Navigation</h3>
<p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="api.html">Status Page API</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Styleguide</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#practices">Practices</a></li>
<li class="toctree-l2"><a class="reference internal" href="#testing">Testing</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="howto.html">How-To</a></li>
<li class="toctree-l1"><a class="reference internal" href="todo.html">Roadmap</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="index.html">Documentation overview</a><ul>
      <li>Previous: <a href="api.html" title="previous chapter">Status Page API</a></li>
      <li>Next: <a href="howto.html" title="next chapter">How-To</a></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>$('#searchbox').show(0);</script>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2021, Ivan Georgiev.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 4.3.1</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.12</a>
      
      |
      <a href="_sources/styleguide.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>